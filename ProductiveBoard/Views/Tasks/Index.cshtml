
@using Microsoft.AspNetCore.Identity

@{
    ViewData["Title"] = "Home Page";
}

@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
@model ProductiveBoard.Models.Task

<style>
    iframe {
        position: fixed !important;
        right: 25px !important;
        top: 90px !important;
        box-shadow: 0px 0px 5px -2px;
    }
</style>

@if (SignInManager.IsSignedIn(User))
{
    @if (ViewBag.tasks != null && ViewBag.tasks.Count == 0)
    {
        <i class="fa fa-list fa-5x" style="text-align: center; width: 100%; position: relative; top: 132px; color: #7a7a7a; font-size: 130px;" aria-hidden="true"></i>
        <div style="position: relative; top: 132px; text-align: center; width: 100%; font-size: 19px; color: #7a7a7a; font-weight: bold;">No Tasks To Display</div>
    }
    <div class="row">
        @for (var i = 0; ViewBag.tasks != null && i < ViewBag.tasks.Count; i++)
        {
            <div class="row col-xl-3 col-lg-3">
                <div class="card" style="margin:10px; width:100%;">
                    <div class="card-body" style="margin-top: 23px;">
                        <span class="badge badge-pill badge-secondary" style="position:absolute;right:5px; top:5px;">@ViewBag.tasks[i].Type.Name</span>
                        <span class="badge badge-pill badge-primary" style="position:absolute;left:5px; top:5px; background-color:#3f51b5">@ViewBag.tasks[i].Status.Name</span>
                        <h5 class="card-title">@ViewBag.tasks[i].Title</h5>
                        <h6 class="card-subtitle mb-2 text-muted">@ViewBag.tasks[i].User.UserName</h6>
                        <p class="card-text" style="padding-bottom: 30px;">@ViewBag.tasks[i].Description</p>
                        <button style="font-weight: bold; position:absolute; left:10px; bottom:10px;" type="button" class="btn btn-link" data-toggle="modal" data-target="#edit-task" onclick="fillValues('@ViewBag.tasks[i].Title', '@ViewBag.tasks[i].Description', '@ViewBag.tasks[i].Id', '@ViewBag.tasks[i].StatusId', '@ViewBag.tasks[i].TypeId', '@ViewBag.tasks[i].UserId')">Edit</button>
                        <form method="post" id="delete-task-@ViewBag.tasks[i].Id" enctype="multipart/form-data" asp-controller="Tasks" asp-action="Delete">
                            <input type="hidden" name="Id" value="@ViewBag.tasks[i].Id" />
                            <button style="font-weight: bold; position: absolute; right: 10px; bottom: 10px;" type="button" class="btn btn-link" onclick="deleteGeneric('task', '@ViewBag.tasks[i].Id')">Delete</button>
                        </form>
                        <!--<a href="#" class="card-link">Delete</a>-->
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#new-task" style="position: fixed; left:60px; bottom:40px;">
        Add New Task
    </button>

    <!-- New Task Modal -->
    <div class="modal fade" id="new-task" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add New Task</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="post" enctype="multipart/form-data" asp-controller="Tasks" asp-action="Create">
                    <div class="modal-body">
                        <input class="form-control" type="text" placeholder="Task Title" name="Title"><br />
                        <input class="form-control" type="text" placeholder="Task Description" name="Description"><br />
                        <select class="custom-select" required name="UserId">
                            <option value="">Link User To Task</option>
                            @for (int i = 0; i < ViewBag.users.Count; i++)
                            {
                                <option value="@ViewBag.users[i].Id">@ViewBag.users[i].UserName</option>
                            }
                        </select>
                        <br /><br />
                        <select class="custom-select" required name="TypeId">
                            <option value="">Select Task Type</option>
                            @for (int i = 0; i < ViewBag.taskTypes.Count; i++)
                            {
                                <option value="@ViewBag.taskTypes[i].Id">@ViewBag.taskTypes[i].Name</option>
                            }
                        </select>
                        <br /><br />
                        <select class="custom-select" required name="StatusId">
                            <option value="">Select Task Status</option>
                            @for (int i = 0; i < ViewBag.TaskStatuses.Count; i++)
                            {
                                <option value="@ViewBag.TaskStatuses[i].Id">@ViewBag.TaskStatuses[i].Name</option>
                            }
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" onclick="addTask()">Add Task</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!--Edit Task Modal-->
    <div class="modal fade" id="edit-task" tabindex="-1" aria-labelledby="EditTask" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Update Task</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="post" enctype="multipart/form-data" asp-controller="Tasks" asp-action="Update">
                    <div class="modal-body">

                        <input class="form-control" type="text" placeholder="Task Title" id="task-title" name="Title"><br />
                        <input class="form-control" type="text" placeholder="Task Description" id="task-desc" name="Description"><br />
                        <input type="hidden" name="Id" id="task-id" />
                        <select class="custom-select" id="task-user" required name="UserId">
                            <option value="">Link User To Task</option>
                            @for (int i = 0; i < ViewBag.users.Count; i++)
                            {
                                <option value="@ViewBag.users[i].Id">@ViewBag.users[i].UserName</option>
                            }
                        </select>
                        <br /><br />
                        <select class="custom-select" id="task-type" required name="TypeId">
                            <option value="">Select Task Type</option>
                            @for (int i = 0; i < ViewBag.taskTypes.Count; i++)
                            {
                                <option value="@ViewBag.taskTypes[i].Id">@ViewBag.taskTypes[i].Name</option>
                            }
                        </select>
                        <br /><br />
                        <select class="custom-select" id="task-status" required name="StatusId">
                            <option value="">Select Task Status</option>
                            @for (int i = 0; i < ViewBag.TaskStatuses.Count; i++)
                            {
                                <option value="@ViewBag.TaskStatuses[i].Id">@ViewBag.TaskStatuses[i].Name</option>
                            }
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" onclick="addTask()">Save Task</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <a class="twitter-timeline" href="https://twitter.com/dotnet" data-widget-id="661486332787580928" data-screen-name="cshtml" width="350" height="666" data-chrome="noborders">
    </a>
    
    <script async defer>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + "://platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs); } }(document, "script", "twitter-wjs");</script>

}
else
{
    <h3>Unauthorized!</h3>
}

<script src="~/js/Task/task.js"></script>